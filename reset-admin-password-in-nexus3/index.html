<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="Nexus3 重置 admin 账号密码"/><link rel="alternate" href="/atom.xml" title="Max's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.1" />
<link rel="canonical" href="http://www.immaxfang.com/reset-admin-password-in-nexus3/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.1" />

<script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?67809b4ebdab46caa23b4831eaa0da9a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-NMPJ73S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GTM-NMPJ73S');
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>Nexus3 重置 admin 账号密码 - Max's Blog</title>
  <meta name="generator" content="Hexo 5.4.2"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Max's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a target="_blank" rel="noopener" href="https://memos.immaxfang.com/">
        <li class="mobile-menu-item">Memos
          </li>
      </a><a href="/link">
        <li class="mobile-menu-item">Link
          </li>
      </a><a href="/atom.xml">
        <li class="mobile-menu-item">RSS
          </li>
      </a><a href="/about">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Max's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" target="_blank" rel="noopener" href="https://memos.immaxfang.com/">
            Memos
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/link">
            Link
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/atom.xml">
            RSS
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">Nexus3 重置 admin 账号密码
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2023-06-14
        </span></div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF"><span class="toc-text">问题背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="toc-text">环境说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-text">操作步骤 </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%20-nexus-%20%E6%9C%8D%E5%8A%A1"><span class="toc-text">停止 nexus 服务 </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%20-OrientDB-%20%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-text">进入 OrientDB 控制台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">进入数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%20-admin-%20%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-text">调整 admin 账号密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%20-nexus-%20%E6%9C%8D%E5%8A%A1"><span class="toc-text">恢复 nexus 服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E8%B4%A6%E5%8F%B7"><span class="toc-text">验证账号 </span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="toc-text">问题记录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%8F%82%E8%80%83"><span class="toc-text">文档参考</span></a></li></ol>
    </div>
  </div><div class="post-content"><h1 id="问题背景"><a href="# 问题背景" class="headerlink" title="问题背景"></a>问题背景</h1><p>nexus3 的 admin 账号密码忘记了，需要重置。</p>
<h1 id="环境说明"><a href="# 环境说明" class="headerlink" title="环境说明"></a>环境说明</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nexus 基于 docker-compose 部署，版本 nexus3.26</span><br><span class="line">docker 镜像 sonatype/nexus3:3.26.1</span><br></pre></td></tr></table></figure>
<h1 id="操作步骤"><a href="# 操作步骤" class="headerlink" title="操作步骤"></a>操作步骤 </h1><p> 参考： <a target="_blank" rel="noopener" href="https://support.sonatype.com/hc/en-us/articles/213467158-How-to-reset-a-forgotten-admin-password-in-Nexus-3-x">https://support.sonatype.com/hc/en-us/articles/213467158-How-to-reset-a-forgotten-admin-password-in-Nexus-3-x</a></p>
<span id="more"></span>
<h2 id="停止 -nexus- 服务"><a href="# 停止 -nexus- 服务" class="headerlink" title="停止 nexus 服务"></a>停止 nexus 服务 </h2><p> 由于 nexus 是基于 docker 部署，后面我们需要进入容器中执行相关命令，所以此处不能直接使用 <code>docker stop xxx</code> 来关闭服务。需要进入到容器内部来关闭 nexus 服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 进入 docker 容器内，注意，此处使用 root 用户，否则后续命令会无权限</span><br><span class="line">docker exec -u root -it nexus3 /bin/bash</span><br><span class="line"># 停止服务</span><br><span class="line">/opt/sonatype/nexus/bin/nexus stop</span><br><span class="line"># 核对服务状态</span><br><span class="line">/opt/sonatype/nexus/bin/nexus status</span><br></pre></td></tr></table></figure>
<p>说明：此处 docker 容器中 nexus 服务关闭的情况可能各不相同，此处找到了镜像原始 dockerfile，从中服务启动时执行的路径，推测出其关闭服务的命令。启动服务命令是  <code>CMD [&quot;/opt/sonatype/nexus/bin/nexus&quot;, &quot;run&quot;]</code>，则尝试使用 <code>/opt/sonatype/nexus/bin/nexus stop</code> 来关闭服务。<br>参考： <a target="_blank" rel="noopener" href="https://github.com/sonatype/docker-nexus3/blob/main/Dockerfile">https://github.com/sonatype/docker-nexus3/blob/main/Dockerfile</a> </p>
<h2 id="进入 -OrientDB- 控制台"><a href="# 进入 -OrientDB- 控制台" class="headerlink" title="进入 OrientDB 控制台"></a>进入 OrientDB 控制台</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar $NEXUS_HOME/lib/support/nexus-orient-console.jar</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要根据 nexus 各自的安装情况执行上述命令。</p>
</blockquote>
<p>参考： <a target="_blank" rel="noopener" href="https://support.sonatype.com/hc/en-us/articles/115002930827-Accessing-the-OrientDB-Console">https://support.sonatype.com/hc/en-us/articles/115002930827-Accessing-the-OrientDB-Console</a></p>
<h2 id="进入数据库"><a href="# 进入数据库" class="headerlink" title="进入数据库"></a>进入数据库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查看 db 目录，根据实际情况查找到目录</span><br><span class="line">ls -alh nexus-data/db/security</span><br><span class="line"># 连接数据库，此处 `nexus-data/db/security` 根据实际 db 目录进行调整</span><br><span class="line">connect plocal:nexus-data/db/security admin admin</span><br></pre></td></tr></table></figure>
<h2 id="调整 -admin- 账号密码"><a href="# 调整 -admin- 账号密码" class="headerlink" title="调整 admin 账号密码"></a>调整 admin 账号密码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查看 admin 用户信息</span><br><span class="line">select * from user where id = &quot;admin&quot;</span><br><span class="line"># 更新 admin 用户的密码为 admin123</span><br><span class="line">update user SET password=&quot;$shiro1$SHA-512$1024$NE+wqQq/TmjZMvfI7ENh/g==$V4yPw8T64UQ6GfJfxYq2hLsVrBY8D1v+bktfOxGdt4b/9BthpWPNUy/CBk6V9iA0nHpzYzJFWO8v/tZFtES8CA==&quot; UPSERT WHERE id=&quot;admin&quot;</span><br></pre></td></tr></table></figure>
<p>注意：为了方便，此处先临时将密码更新为 <code>admin123</code>。<br>若要退出 OrientDB 控制台，输入 <code>exit;</code> 即可退出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orientdb &#123;db=security&#125;&gt; exit;</span><br></pre></td></tr></table></figure>
<h2 id="恢复 -nexus- 服务"><a href="# 恢复 -nexus- 服务" class="headerlink" title="恢复 nexus 服务"></a>恢复 nexus 服务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 启动服务</span><br><span class="line">/opt/sonatype/nexus/bin/nexus start</span><br><span class="line"># 核对服务状态</span><br><span class="line">/opt/sonatype/nexus/bin/nexus status</span><br></pre></td></tr></table></figure>
<h2 id="验证账号"><a href="# 验证账号" class="headerlink" title="验证账号"></a>验证账号 </h2><p> 使用 <code>admin:admin123</code> 帐密来登录 nexus 服务，验证是否调整正确。若确认调整成功，建议及时使用更复杂的密码替换临时密码 <code>admin123</code> 。</p>
<h1 id="问题记录"><a href="# 问题记录" class="headerlink" title="问题记录"></a>问题记录</h1><ul>
<li>报没有权限<blockquote>
<p>Error creating history file java.io.IOException: Permission denied at java.io.UnixFileSystem.createFileExclusively(Native Method) at java.io.File.createNewFile(File.java:1012) at</p>
</blockquote>
</li>
</ul>
<p>一开始使用 <code>docker exec -it nexus3 /bin/bash</code> 进入容器，执行进行 OrientDB 命令时，会报无权限，且无法使用 <code>sudo su</code> 切换用户。使用 <code>docker exec -u root -it nexus3 /bin/bash</code> 即可。</p>
<p>参考： <a target="_blank" rel="noopener" href="https://gist.github.com/marcelmaatkamp/123e8793e07a72a382d8d0e8d66bbd8f?permalink_comment_id=3276537">https://gist.github.com/marcelmaatkamp/123e8793e07a72a382d8d0e8d66bbd8f?permalink_comment_id=3276537</a></p>
<h1 id="文档参考"><a href="# 文档参考" class="headerlink" title="文档参考"></a>文档参考</h1><p><a target="_blank" rel="noopener" href="https://support.sonatype.com/hc/en-us/articles/213467158-How-to-reset-a-forgotten-admin-password-in-Nexus-3-x">How to reset a forgotten admin password in Sonatype Nexus Repository 3</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/forever521Lee/p/10919512.html">Nexus3.X 忘记 admin 密码找回</a></p>

      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <a href="http://www.immaxfang.com">Max Fang</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="http://www.immaxfang.com/reset-admin-password-in-nexus3/">http://www.immaxfang.com/reset-admin-password-in-nexus3/</a>
    </p>
    <p class="copyright-item">
      <span>License: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>
      <footer class="post-footer">
        
        <nav class="post-nav"><a class="next" href="/kubernetes-v1-25-service-account-secret-not-listed/">
        <span class="next-text nav-default">【k8s 入门】Kubernetes v1.25 创建 ServiceAccount 未生成 Secret 问题</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><div id="vcomments"></div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:maxfang007@gmail.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/FX-Max" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2020 - 2023<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Max Fang</span><span class="division">|</span>
      <a class="theme-link" href=https://beian.miit.gov.cn/>皖ICP备2022015199号</a><span class="division">|</span>
      <span id="busuanzi_container_site_pv">
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
      </span></span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><!-- valine Comments -->
<script src="//github.elemecdn.com/leancloud-storage@3/dist/av-min.js"></script>
<script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.5.1/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: "RoaKz6A3wbmwNFIRl6bNdOqC-gzGzoHsz",
        app_key: "zRlIClO248YJDPefLLQe0F0B",
        placeholder: "写下你的留言把！",
        avatar: 'mm'
    });
</script>
<script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.1"></script>
</body>
</html>
